<<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR Business Card — MindAR + A-Frame</title>

    <!-- A-Frame + MindAR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      body { margin: 0; font-family: Inter, Roboto, Arial, sans-serif; background: #000; }
      #hint {
        position: fixed; left: 12px; right: 12px; bottom: 12px;
        background: rgba(0,0,0,0.6); color: #fff; padding: 8px 12px;
        border-radius: 8px; font-size: 14px; text-align: center;
        z-index: 9998;
      }
      #soundPrompt {
        position: fixed; left: 50%; transform: translateX(-50%);
        top: 18px; background: rgba(255,255,255,0.95); color: #0b2148;
        padding: 10px 16px; border-radius: 10px; font-weight: 600;
        display: none; z-index: 9999;
      }
      #soundPrompt button {
        margin-left: 10px; background: #ff6600; color: white; border: none;
        padding: 6px 10px; border-radius: 6px; cursor: pointer; font-weight: 700;
      }
      a-scene { width: 100vw; height: 100vh; }
    </style>
  </head>

  <body>
    <div id="hint">Point your camera at the printed card. Tap once if sound doesn't start.</div>
    <div id="soundPrompt">
      Sound is locked — tap to enable
      <button id="enableSoundBtn">Enable sound</button>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: Assets/targets.mind;"
      embedded
      color-space="sRGB"
      renderer="colorManagement: true; physicallyCorrectLights: true; toneMapping: ACESFilmicToneMapping; outputEncoding: sRGBEncoding"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-assets>
        <img id="poster" src="assets/call.png" crossorigin="anonymous" />
        <video id="video"
               src="assets/website.mp4"
               loop
               playsinline
               webkit-playsinline
               preload="auto"
               crossorigin="anonymous"
               muted></video>

        <a-asset-item id="sceneModel" src="assets/scene.glb"></a-asset-item>

        <img id="iconCall" src="assets/call.png" crossorigin="anonymous" />
        <img id="iconLinked" src="assets/linkedin.png" crossorigin="anonymous" />
        <img id="iconWeb" src="assets/website.png" crossorigin="anonymous" />
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0" id="cardTarget">
        <a-plane id="posterPlane"
                 src="#poster"
                 width="1.0" height="0.552"
                 position="0 0 0.01"></a-plane>

        <a-video id="videoPlane"
                 src="#video"
                 width="0.9" height="0.5"
                 position="0 0.02 0.02"
                 rotation="-6 0 0"
                 visible="false"
                 material="shader: standard; metalness: 0.05; roughness: 0.6; toneMapped: true">
        </a-video>

        <a-ring id="glowRing"
                position="0 0.02 0.015"
                rotation="-90 0 0"
                radius-inner="0.22" radius-outer="0.30"
                material="color: #2fe0ff; opacity: 0.12; side: double"
                visible="false"></a-ring>

        <a-entity id="modelHolder" position="0.32 0.18 0.08" visible="false">
          <a-gltf-model id="avatarModel"
                        src="#sceneModel"
                        scale="0.004 0.004 0.004"
                        rotation="0 200 0"
                        animation__float="property: position; dir: alternate; dur: 1800; loop: true; to: 0.32 0.22 0.08; easing: easeInOutSine"
                        animation__spin="property: rotation; from: 0 200 0; to: 0 560 0; dur: 9000; loop: true; easing: linear">
          </a-gltf-model>
        </a-entity>

        <a-text id="nameText" value="YASER ALKYLANI" position="0 0.34 0.02" align="center" width="1.8" color="#0B2148" opacity="0"></a-text>
        <a-text id="titleText" value="Founder & CEO" position="0 0.28 0.02" align="center" width="1.6" color="#FF6600" opacity="0"></a-text>

        <a-image id="icon1" src="#iconCall" width="0.12" height="0.12" position="-0.28 -0.38 0.02" visible="false" class="clickable"></a-image>
        <a-image id="icon2" src="#iconLinked" width="0.12" height="0.12" position="0 -0.38 0.02" visible="false" class="clickable"></a-image>
        <a-image id="icon3" src="#iconWeb" width="0.12" height="0.12" position="0.28 -0.38 0.02" visible="false" class="clickable"></a-image>
      </a-entity>
    </a-scene>

    <script>
      const videoEl = document.querySelector('#video');
      const videoPlane = document.querySelector('#videoPlane');
      const posterPlane = document.querySelector('#posterPlane');
      const glowRing = document.querySelector('#glowRing');
      const modelHolder = document.querySelector('#modelHolder');
      const nameText = document.querySelector('#nameText');
      const titleText = document.querySelector('#titleText');
      const icons = [
        document.querySelector('#icon1'),
        document.querySelector('#icon2'),
        document.querySelector('#icon3')
      ];
      const hint = document.querySelector('#hint');
      const soundPrompt = document.querySelector('#soundPrompt');
      const enableBtn = document.querySelector('#enableSoundBtn');

      let userUnlockedSound = false;

      function showUI() {
        nameText.setAttribute('opacity', 1);
        titleText.setAttribute('opacity', 1);
        icons.forEach(ic => ic.setAttribute('visible', true));
      }

      document.querySelector('#cardTarget').addEventListener('targetFound', async () => {
        hint.innerText = 'Card detected — loading...';
        glowRing.setAttribute('visible', true);
        modelHolder.setAttribute('visible', true);
        showUI();

        try {
          await videoEl.play(); // muted autoplay
          posterPlane.setAttribute('visible', false);
          videoPlane.setAttribute('visible', true);
        } catch {
          soundPrompt.style.display = 'block';
          posterPlane.setAttribute('visible', true);
        }
      });

      document.querySelector('#cardTarget').addEventListener('targetLost', () => {
        videoEl.pause();
        videoPlane.setAttribute('visible', false);
        posterPlane.setAttribute('visible', true);
        glowRing.setAttribute('visible', false);
        modelHolder.setAttribute('visible', false);
        soundPrompt.style.display = 'none';
        hint.innerText = 'Point camera at the printed card';
      });

      enableBtn.addEventListener('click', async () => {
        try {
          videoEl.muted = false;
          await videoEl.play();
          userUnlockedSound = true;
          soundPrompt.style.display = 'none';
          posterPlane.setAttribute('visible', false);
          videoPlane.setAttribute('visible', true);
        } catch {}
      });

      document.querySelector('#icon1').addEventListener('click', () => window.open('tel:+966500800628','_blank'));
      document.querySelector('#icon2').addEventListener('click', () => window.open('https://linkedin.com/in/yourprofile','_blank'));
      document.querySelector('#icon3').addEventListener('click', () => window.open('https://yourwebsite.com','_blank'));
    </script>
  </body>
</html>
